<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Stars Dashboard</title>
    <style>
      :root { font-family: system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, sans-serif; color-scheme: light dark; }
      body { margin: 2rem; line-height: 1.5; height: 100vh; overflow: hidden; }
      .topbar { display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; align-items: center; }
      @media (max-width: 900px) { .topbar { grid-template-columns: 1fr; } }
      .top-left { display: grid; gap: .6rem; align-content: start; }
      .top-right { display: flex; align-items: center; justify-content: flex-end; }
      h1 { margin: 0 0 1rem; font-size: 1.5rem; }
      .row { display: flex; gap: 1rem; align-items: center; flex-wrap: wrap; }
      input[type="text"] { padding: .4rem .6rem; min-width: 20rem; }
      button { padding: .38rem .7rem; cursor: pointer; border: 1px solid #8884; background: #ffffff10; color: inherit; border-radius: 4px; }
      .layout { display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; align-items: start; margin-top: 1rem; }
      @media (max-width: 900px) { .layout { grid-template-columns: 1fr; } }
      .col { min-width: 0; }
      .group { margin: .6rem 0; }
      .group-title { font-size: .9rem; opacity: .75; margin: 0 0 .4rem; }
      .stats-row { display: grid; grid-template-columns: repeat(4, minmax(0, 1fr)); column-gap: 2rem; align-items: end; }
      .stats2x5 { display:grid; grid-template-columns: var(--label-col, 260px) repeat(4, 1fr); column-gap: 2rem; row-gap: .8rem; align-items: end; }
      .metric { display: grid; grid-template-rows: auto auto; min-height: 2.4rem; }
      .label { font-size: .9rem; opacity: .75; }
      .value { font-size: 1.4rem; font-weight: 700; line-height: 1.1; text-align: right; font-variant-numeric: tabular-nums; transition: color .2s ease, transform .2s ease; will-change: color, transform; }
      .metric.empty { visibility: hidden; }
      .value.flash-up { color: #16a34a; transform: scale(1.06); }
      .value.flash-down { color: #f59e0b; transform: scale(1.06); }
      /* old table styles removed */
      .muted { opacity: .7; }
      .actions { display: flex; flex-wrap: wrap; gap: .5rem; }
      .actions button { border-radius: 4px; }
      .status { margin-left: .5rem; font-size: .9rem; }
      .log { border: 1px solid #8884; border-radius: .5rem; background: #1112; padding: .6rem; height: 300px; overflow: auto; white-space: pre-wrap; font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono", monospace; }
      .pills { display: flex; flex-wrap: wrap; gap: .4rem; }
      .pill { display: inline-block; border: 1px solid #8884; border-radius: 4px; padding: .25rem .45rem; font-size: .85rem; background: #0001; }
      .pill .pill-name { opacity: .85; }
      .pill .pill-count { opacity: .85; font-variant-numeric: tabular-nums; }
      .logs-bar { display:flex; align-items:center; justify-content:space-between; gap:.5rem; margin:.4rem 0; }
      .logs-left { display:flex; align-items:center; gap:.5rem; }
    </style>
  </head>
  <body>
    <div class="topbar">
      <div class="top-left">
        <h1>Stars Live Dashboard</h1>
        <div class="row">
          <label for="dir">Exports directory:</label>
          <input id="dir" type="text" value="./exports" />
          <button id="saveDir">Save</button>
          <span class="muted">(default: ./exports)</span>
        </div>
      </div>
      <div class="top-right"></div>
    </div>

    <div style="margin-top:1rem">
      <strong>Logs</strong>
      <div class="logs-bar">
        <div class="logs-left">
          <button id="clearLog">Clear</button>
          <span class="muted">Live stream (last 1000 lines)</span>
        </div>
        <div class="actions">
          <button data-task="lists" title="lists">Lists</button>
          <button data-task="unlisted" title="unlisted">Unlisted</button>
          <button data-task="ingest" title="ingest">Ingest</button>
          <button data-task="summarise" title="summarise --apply">Summary</button>
          <button data-task="score" title="score --apply">Score</button>
          <button data-task="topics:enrich" title="topics:enrich">Topics</button>
          <span class="status" id="status"></span>
        </div>
      </div>
      <pre id="log" class="log" aria-live="polite" aria-atomic="false"></pre>
    </div>

    <div class="layout">
      <section class="col col-left">
        <div class="group">
          <div class="stats2x5">
            <div class="group-title">From JSON</div>
            <div class="metric"><div class="label">Lists</div><div class="value" id="jsonLists">–</div></div>
            <div class="metric"><div class="label">Repos</div><div class="value" id="jsonRepos">–</div></div>
            <div class="metric"><div class="label">Unlisted</div><div class="value" id="jsonUnlisted">–</div></div>
            <div class="metric empty"></div>

            <div class="group-title">From SQLite</div>
            <div class="metric"><div class="label">Lists</div><div class="value" id="dbLists">–</div></div>
            <div class="metric"><div class="label">Repos</div><div class="value" id="dbRepos">–</div></div>
            <div class="metric"><div class="label">Summarised</div><div class="value" id="dbSumm">–</div></div>
            <div class="metric"><div class="label">Scored</div><div class="value" id="dbScored">–</div></div>
          </div>
        </div>
      </section>
      <section class="col col-right" style="display:flex;flex-direction:column;gap:.6rem;min-height:0;">
        <div class="group" style="flex:1 1 auto; min-height:0;">
          <div class="group-title">Per List (DB)</div>
          <div id="perListPills" class="pills" aria-live="polite" style="height: 30vh; min-height:120px; overflow:auto;"><span class="muted">Loading…</span></div>
        </div>
      </section>
    </div>

    <script type="module" src="/app.js"></script>
  </body>
  </html>
