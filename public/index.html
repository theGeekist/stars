<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Stars Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
      @keyframes bg-flash-inc { from { background-color: rgba(34,197,94,0.18); } to { background-color: transparent; } }
      @keyframes bg-flash-dec { from { background-color: rgba(245,158,11,0.18); } to { background-color: transparent; } }
      .flash-bg-inc { animation: bg-flash-inc 700ms ease-out; }
      .flash-bg-dec { animation: bg-flash-dec 700ms ease-out; }

      /* Subtle running-state for task buttons */
      .is-running {
        background-color: rgba(59, 130, 246, 0.12);
        border-color: rgba(59, 130, 246, 0.6);
      }
    </style>
  </head>
  <body class="font-sans text-slate-900 dark:text-slate-100 bg-white dark:bg-slate-900">
    <div class="mx-8 my-6 grid grid-cols-1 lg:grid-cols-2 gap-4 items-start">
      <div class="space-y-2">
        <h1 class="text-xl font-semibold">Stars Live Dashboard</h1>
        <div class="flex flex-wrap items-center gap-2">
          <label for="dir" class="text-slate-600 dark:text-slate-300">Exports directory:</label>
          <input id="dir" type="text" value="./exports" class="px-2 py-1 min-w-[20rem] border border-slate-300 dark:border-slate-700 rounded bg-transparent" />
          <button id="saveDir" class="px-3 py-1 border border-slate-400/40 rounded hover:bg-slate-100/50 dark:hover:bg-slate-800/50">Save</button>
          <span class="opacity-70 text-sm">(default: ./exports)</span>
        </div>
      </div>
      <div></div>
    </div>

    <div class="mx-8">
      <strong>Logs</strong>
      <div class="flex items-center justify-between gap-2 my-2">
        <div class="flex items-center gap-2">
          <button id="clearLog" class="px-3 py-1 border border-slate-400/40 rounded hover:bg-slate-100/50 dark:hover:bg-slate-800/50">Clear</button>
          <span class="opacity-70 text-sm">Live stream (last 1000 lines)</span>
        </div>
        <div class="flex flex-wrap gap-2 items-center">
          <button data-task="ingest" title="ingest" class="px-3 py-1 border rounded">Ingest</button>
          <button data-task="summarise" title="summarise --apply" class="px-3 py-1 border rounded">Summary</button>
          <button data-task="score" title="score --apply" class="px-3 py-1 border rounded">Score</button>
          <button data-task="topics:enrich" title="topics:enrich" class="px-3 py-1 border rounded">Topics</button>
          <span class="ml-2 text-sm" id="status"></span>
        </div>
      </div>
      <pre id="log" class="border border-slate-400/40 rounded bg-black/5 dark:bg-white/5 p-2 h-72 overflow-auto whitespace-pre-wrap font-mono"></pre>
    </div>

    <div class="mx-8 mt-4 grid grid-cols-1 lg:grid-cols-2 gap-4 items-start">
      <section class="min-w-0">
        <div class="space-y-2">
          <table class="min-w-full text-sm">
            <thead class="opacity-75">
              <tr>
                <th class="text-left font-normal w-48">Source</th>
                <th class="text-left font-normal">Lists</th>
                <th class="text-left font-normal">Repos</th>
                <th class="text-left font-normal">Unlisted</th>
                <th class="text-left font-normal">Summarised</th>
                <th class="text-left font-normal">Scored</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td class="opacity-75">From JSON</td>
                <td class="font-bold text-lg tabular-nums" id="jsonLists" data-flash-container>–</td>
                <td class="font-bold text-lg tabular-nums" id="jsonRepos" data-flash-container>–</td>
                <td class="font-bold text-lg tabular-nums" id="jsonUnlisted" data-flash-container>–</td>
                <td class="opacity-50">—</td>
                <td class="opacity-50">—</td>
              </tr>
              <tr>
                <td class="opacity-75">From SQLite</td>
                <td class="font-bold text-lg tabular-nums" id="dbLists" data-flash-container>–</td>
                <td class="font-bold text-lg tabular-nums" id="dbRepos" data-flash-container>–</td>
                <td class="opacity-50">—</td>
                <td class="font-bold text-lg tabular-nums" id="dbSumm" data-flash-container>–</td>
                <td class="font-bold text-lg tabular-nums" id="dbScored" data-flash-container>–</td>
              </tr>
            </tbody>
          </table>
        </div>
      </section>
      <section class="flex flex-col gap-2 min-h-0">
        <div class="flex-1 min-h-0">
          <div class="text-sm opacity-75">Per List (DB)</div>
          <div id="perListPills" class="h-[30vh] min-h-[120px] overflow-auto" aria-live="polite"><span class="opacity-70">Loading…</span></div>
        </div>
      </section>
    </div>

    <script type="module" src="/main.js"></script>
  </body>
  </html>
